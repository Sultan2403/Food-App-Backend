<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>JSON File Upload Test</title>
</head>

<body>
    <h2>Test JSON File Upload</h2>
    <input type="file" id="fileInput" />
    <button id="uploadBtn">Upload</button>

    <p id="status"></p>

    <script>
        const uploadBtn = document.getElementById('uploadBtn');
        const fileInput = document.getElementById('fileInput');
        const status = document.getElementById('status');

        uploadBtn.addEventListener('click', () => {
            const file = fileInput.files[0];
            if (!file) {
                status.textContent = 'Please select a file first.';
                return;
            }

            const reader = new FileReader();

            reader.onload = async () => {
                // Convert file to Base64 string and remove prefix
                const base64String = reader.result.split(',')[1];

                // Build JSON payload
                const payload = { imageCover: base64String, filename: file.name, mimeType: file.type };

                try {
                    const response = await fetch('http://localhost:5000/items', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    // Check if the response is JSON
                    const text = await response.text();
                    let data;
                    try {
                        data = JSON.parse(text);
                    } catch {
                        throw new Error('Server did not return JSON: ' + text);
                    }

                    status.textContent = 'Upload successful: ' + JSON.stringify(data);
                } catch (err) {
                    console.error(err);
                    status.textContent = 'Upload failed: ' + err.message;
                }
            };

            reader.readAsDataURL(file);
        });
    </script>
</body>

</html>